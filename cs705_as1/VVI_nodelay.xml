<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>// Place global declarations here.

// random atria and ventricle bounds
const int Vmaxwait = 1000;
const int Vminwait = 300;
const int Amaxwait = 1000;
const int Aminwait = 300;

// given timing constraints
const int TAEI = 800; // atrial escape period
const int TAVI = 150; // atrio ventricular interval 
const int TVRP = 150; // ventricular refract. period
const int TPVARP = 100; // post ventricular atrial refract. preiod
const int TURI = 400; // upper rate interval
const int TLRI = AEI + AVI; // lower arte interval
</declaration>
	<template>
		<name>RV</name>
		<parameter>broadcast chan &amp;VSense, broadcast chan &amp;VP</parameter>
		<declaration>clock x;</declaration>
		<location id="id0" x="0" y="-24">
			<name x="-10" y="-54">RV</name>
			<label kind="invariant" x="24" y="-32">x&lt;Vmaxwait</label>
		</location>
		<init ref="id0"/>
		<transition id="id1">
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="-24" y="24">x&gt;Vminwait</label>
			<label kind="synchronisation" x="-24" y="40">VSense!</label>
			<label kind="assignment" x="-16" y="56">x=0</label>
			<nail x="-32" y="24"/>
			<nail x="32" y="24"/>
		</transition>
		<transition id="id2">
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-16" y="-104">VP?</label>
			<label kind="assignment" x="-16" y="-88">x=0</label>
			<nail x="-32" y="-72"/>
			<nail x="40" y="-72"/>
		</transition>
	</template>
	<template>
		<name>RA</name>
		<parameter>broadcast chan &amp;ASense, broadcast chan &amp;AP</parameter>
		<declaration>clock x;</declaration>
		<location id="id3" x="-17" y="-25">
			<name x="-27" y="-55">RA</name>
			<label kind="invariant" x="7" y="-33">x&lt;Amaxwait</label>
		</location>
		<init ref="id3"/>
		<transition id="id4">
			<source ref="id3"/>
			<target ref="id3"/>
			<label kind="guard" x="-41" y="23">x&gt;Aminwait</label>
			<label kind="synchronisation" x="-41" y="39">ASense!</label>
			<label kind="assignment" x="-33" y="55">x=0</label>
			<nail x="-49" y="23"/>
			<nail x="15" y="23"/>
		</transition>
		<transition id="id5">
			<source ref="id3"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-33" y="-105">AP?</label>
			<label kind="assignment" x="-33" y="-89">x=0</label>
			<nail x="-49" y="-73"/>
			<nail x="23" y="-73"/>
		</transition>
	</template>
	<template>
		<name x="5" y="5">LRI</name>
		<parameter>broadcast chan &amp;AP, broadcast chan &amp;ASense, broadcast chan &amp;VP, broadcast chan &amp;VS</parameter>
		<declaration>clock x;</declaration>
		<location id="id6" x="17" y="34">
			<name x="25" y="8">LRI</name>
		</location>
		<location id="id7" x="17" y="-170">
			<name x="7" y="-204">ASed</name>
		</location>
		<init ref="id6"/>
		<transition id="id8">
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="85" y="-119">VP?</label>
			<label kind="assignment" x="85" y="-102">x=0</label>
			<nail x="85" y="-102"/>
		</transition>
		<transition id="id9">
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-85" y="-119">VS?</label>
			<label kind="assignment" x="-85" y="-102">x=0</label>
			<nail x="-51" y="-102"/>
		</transition>
		<transition id="id10">
			<source ref="id6"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="-8" y="-102">AS?</label>
		</transition>
		<transition id="id11">
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-85" y="8">VS?</label>
			<label kind="assignment" x="-85" y="25">x=0</label>
			<nail x="-51" y="59"/>
			<nail x="-51" y="8"/>
		</transition>
		<transition id="id12">
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="93" y="25">VP?</label>
			<label kind="assignment" x="93" y="42">x=0</label>
			<nail x="85" y="17"/>
			<nail x="85" y="68"/>
		</transition>
		<transition id="id13">
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="guard" x="-17" y="110">x&gt;=TLRI-TAVI</label>
			<label kind="synchronisation" x="-17" y="127">AS!</label>
			<label kind="assignment" x="-17" y="144">x=0</label>
			<nail x="34" y="110"/>
			<nail x="-17" y="110"/>
		</transition>
	</template>
	<template>
		<name>AVI</name>
		<parameter>broadcast chan &amp;VP, broadcast chan &amp;VS, broadcast chan &amp;ASense</parameter>
		<declaration>clock x;</declaration>
		<location id="id14" x="0" y="0">
			<name x="17" y="-25">IDLE</name>
		</location>
		<location id="id15" x="0" y="119">
			<name x="8" y="119">AVI</name>
			<label kind="invariant" x="8" y="136">x&lt;=TAVI</label>
		</location>
		<location id="id16" x="0" y="-119">
			<name x="-25" y="-170">WaitURI</name>
			<label kind="invariant" x="-25" y="-153">x&lt;=TURI</label>
		</location>
		<init ref="id14"/>
		<transition id="id17">
			<source ref="id15"/>
			<target ref="id16"/>
			<label kind="guard" x="-297" y="-17">x&gt;=TAVI &amp;&amp; x&lt;TURI</label>
			<nail x="0" y="153"/>
			<nail x="-144" y="153"/>
			<nail x="-144" y="-119"/>
		</transition>
		<transition id="id18">
			<source ref="id15"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="102" y="42">VS?</label>
			<nail x="93" y="119"/>
			<nail x="93" y="0"/>
		</transition>
		<transition id="id19">
			<source ref="id15"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-119" y="51">VP?</label>
			<nail x="-85" y="119"/>
			<nail x="-85" y="0"/>
		</transition>
		<transition id="id20">
			<source ref="id16"/>
			<target ref="id14"/>
			<label kind="guard" x="51" y="-76">x&gt;=TURI</label>
			<nail x="51" y="-68"/>
		</transition>
		<transition id="id21">
			<source ref="id16"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-76" y="-85">VS?</label>
			<nail x="-51" y="-68"/>
		</transition>
		<transition id="id22">
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="25" y="85">ASense?</label>
			<label kind="assignment" x="25" y="102">x=0</label>
			<nail x="51" y="59"/>
		</transition>
		<transition id="id23">
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-68" y="8">AV?</label>
			<label kind="assignment" x="-68" y="25">x=0</label>
			<nail x="-51" y="59"/>
		</transition>
	</template>
	<template>
		<name>URI</name>
		<parameter>broadcast chan &amp;VP, broadcast chan &amp;VS</parameter>
		<declaration>clock x;</declaration>
		<location id="id24" x="0" y="-8">
			<name x="17" y="-16">URI</name>
		</location>
		<init ref="id24"/>
		<transition id="id25">
			<source ref="id24"/>
			<target ref="id24"/>
			<label kind="synchronisation" x="-17" y="34">VS?</label>
			<label kind="assignment" x="-17" y="51">x=0</label>
			<nail x="-25" y="34"/>
			<nail x="25" y="34"/>
		</transition>
		<transition id="id26">
			<source ref="id24"/>
			<target ref="id24"/>
			<label kind="synchronisation" x="-17" y="-76">VP?</label>
			<label kind="assignment" x="-17" y="-59">x=0</label>
			<nail x="-25" y="-42"/>
			<nail x="25" y="-42"/>
		</transition>
	</template>
	<template>
		<name>AEI</name>
		<parameter>broadcast chan &amp;AP, broadcast chan &amp;AS, broadcast chan &amp;VP, broadcast chan &amp;VS</parameter>
		<location id="id27" x="0" y="0">
			<name x="8" y="8">IDLE</name>
		</location>
		<location id="id28" x="0" y="-68">
			<name x="17" y="-93">AEI</name>
			<label kind="invariant" x="17" y="-110">x&lt;=TAEI</label>
		</location>
		<init ref="id27"/>
		<transition id="id29">
			<source ref="id28"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="-76" y="-119">AS?</label>
			<nail x="0" y="-102"/>
			<nail x="-110" y="-102"/>
			<nail x="-110" y="42"/>
			<nail x="0" y="42"/>
		</transition>
		<transition id="id30">
			<source ref="id28"/>
			<target ref="id27"/>
			<label kind="synchronisation" x="-68" y="-85">AP?</label>
			<nail x="-76" y="-68"/>
			<nail x="-76" y="0"/>
		</transition>
		<transition id="id31">
			<source ref="id28"/>
			<target ref="id27"/>
			<label kind="guard" x="85" y="-59">x&gt;=TAEI</label>
			<label kind="synchronisation" x="85" y="-42">AP!</label>
			<label kind="assignment" x="85" y="-25">x=0</label>
			<nail x="76" y="-68"/>
			<nail x="76" y="0"/>
		</transition>
		<transition id="id32">
			<source ref="id27"/>
			<target ref="id28"/>
			<label kind="synchronisation" x="34" y="-51">VP?</label>
			<label kind="assignment" x="34" y="-34">x=0</label>
			<nail x="34" y="-34"/>
		</transition>
		<transition id="id33">
			<source ref="id27"/>
			<target ref="id28"/>
			<label kind="synchronisation" x="-59" y="-51">VS?</label>
			<label kind="assignment" x="-59" y="-34">x=0</label>
			<nail x="-34" y="-34"/>
		</transition>
	</template>
	<template>
		<name>VRP</name>
		<parameter>broadcast chan &amp;VS, broadcast chan &amp;VSense, broadcast chan &amp;VP</parameter>
		<declaration>clock x;</declaration>
		<location id="id34" x="-238" y="-34">
			<name x="-248" y="-68">IDLE</name>
		</location>
		<location id="id35" x="68" y="-34">
			<name x="58" y="-68">VRP</name>
			<label kind="invariant" x="42" y="-85">x&lt;=TVRP</label>
		</location>
		<location id="id36" x="-85" y="-34">
			<name x="-95" y="-68">inter</name>
		</location>
		<init ref="id34"/>
		<transition id="id37">
			<source ref="id36"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="-42" y="-51">VS!</label>
			<label kind="assignment" x="-42" y="-34">x=0</label>
		</transition>
		<transition id="id38">
			<source ref="id34"/>
			<target ref="id36"/>
			<label kind="synchronisation" x="-187" y="-51">VSense?</label>
		</transition>
		<transition id="id39">
			<source ref="id35"/>
			<target ref="id34"/>
			<label kind="guard" x="-119" y="-144">x&gt;=TVRP</label>
			<nail x="-85" y="-127"/>
		</transition>
		<transition id="id40">
			<source ref="id34"/>
			<target ref="id35"/>
			<label kind="synchronisation" x="-102" y="42">VP?</label>
			<label kind="assignment" x="-102" y="59">x=0</label>
			<nail x="-85" y="42"/>
		</transition>
	</template>
	<template>
		<name>PVARP</name>
		<parameter>broadcast chan &amp;AS, broadcast chan &amp;ASense, broadcast chan &amp;VS, broadcast chan &amp;VP</parameter>
		<declaration>clock x;</declaration>
		<location id="id41" x="-51" y="17">
			<name x="-68" y="34">IDLE</name>
		</location>
		<location id="id42" x="-170" y="17">
			<name x="-187" y="34">ASed</name>
			<committed/>
		</location>
		<location id="id43" x="68" y="17">
			<name x="51" y="34">PVARP</name>
			<label kind="invariant" x="52" y="51">x&lt;=TPVARP</label>
			<committed/>
		</location>
		<init ref="id41"/>
		<transition id="id44">
			<source ref="id43"/>
			<target ref="id41"/>
			<label kind="guard" x="-26" y="-101">x&gt;=TPVARP</label>
			<nail x="68" y="-76"/>
			<nail x="-51" y="-75"/>
		</transition>
		<transition id="id45">
			<source ref="id41"/>
			<target ref="id43"/>
			<label kind="synchronisation" x="-9" y="60">VP?</label>
			<label kind="assignment" x="-9" y="77">x=0</label>
			<nail x="8" y="60"/>
		</transition>
		<transition id="id46">
			<source ref="id41"/>
			<target ref="id43"/>
			<label kind="synchronisation" x="-8" y="-59">VS?</label>
			<label kind="assignment" x="-9" y="-42">x=0</label>
			<nail x="8" y="-25"/>
		</transition>
		<transition id="id47">
			<source ref="id42"/>
			<target ref="id41"/>
			<label kind="synchronisation" x="-119" y="-42">AS!</label>
			<nail x="-111" y="-25"/>
		</transition>
		<transition id="id48">
			<source ref="id41"/>
			<target ref="id42"/>
			<label kind="synchronisation" x="-136" y="60">ASense?</label>
			<nail x="-111" y="60"/>
		</transition>
	</template>
	<system>// Declaration goes here.
broadcast chan VSense, VP, VS, ASense, AP, VS;
broadcast chan 


// Place template instantiations here.
Random_Ventricle = RV(VSense, VP);
Random_Atria = RA(ASense, AP);

Con_LRI = LRI();     // out: AP;   in: AS, VS, VP;
Con_VRP = VRP();     // out: VS;   in: VSense, VP;
Con_AVI = AVI();     // out: VP;   in: AS, VS, VP;
Con_URI = URI();     // out: NULL; in: VS, VP;
Con_PVARP = PVARP(); // out: AS;   in: ASense, VS, VP;
Con_AEI = AEI();     // out: AP;   in: AS, AP, VS, VP;

// List one or more processes to be composed into a system.
system Random_Ventricle, Random_Atria, Con_LRI, Con_VRP, Con_AVI, Con_URI, Con_PVARP;
</system>
	<queries>
		<query>
			<formula>A[] (Monitor_VRP.Ex_Get imply Monitor_VRP.t &gt;= TVRP)
			</formula>
			<comment/>
		</query>
		<query>
			<formula>A[] (Monitor_LRI.Detected imply Monitor_LRI.t &lt;= TLRI)
			</formula>
			<comment/>
		</query>
		<query>
			<formula>A[] not deadlock
			</formula>
			<comment/>
		</query>
	</queries>
</nta>
