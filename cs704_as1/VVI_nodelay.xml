<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.

const int TLRI = 800;
const int TVRP = 500;
const int Vmaxwait = 1000;
const int Vminwait = 300;
</declaration>
	<template>
		<name>RV</name>
		<parameter>broadcast chan &amp;VSense, broadcast chan &amp;VP</parameter>
		<declaration>clock x;</declaration>
		<location id="id0" x="0" y="-24">
			<name x="-10" y="-54">RV</name>
			<label kind="invariant" x="24" y="-32">x&lt;Vmaxwait</label>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="-24" y="24">x&gt;Vminwait</label>
			<label kind="synchronisation" x="-24" y="40">VSense!</label>
			<label kind="assignment" x="-16" y="56">x=0</label>
			<nail x="-32" y="24"/>
			<nail x="32" y="24"/>
		</transition>
		<transition>
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="synchronisation" x="-16" y="-104">VP?</label>
			<label kind="assignment" x="-16" y="-88">x=0</label>
			<nail x="-32" y="-72"/>
			<nail x="40" y="-72"/>
		</transition>
	</template>
	<template>
		<name x="5" y="5">LRI</name>
		<parameter>broadcast chan &amp;VSense, urgent chan &amp;LRI_Start, broadcast chan &amp;VRP_Ex, broadcast chan &amp;LRI_Ex, broadcast chan &amp;VP, urgent chan &amp;LRI_Stop</parameter>
		<declaration>// Place local declarations here.
</declaration>
		<location id="id1" x="56" y="-40">
			<committed/>
		</location>
		<location id="id2" x="-48" y="24">
			<committed/>
		</location>
		<location id="id3" x="8" y="-104">
			<committed/>
		</location>
		<location id="id4" x="104" y="24">
			<name x="80" y="40">WaitLRI</name>
		</location>
		<location id="id5" x="104" y="-104">
			<name x="128" y="-112">WaitVRP</name>
		</location>
		<location id="id6" x="-88" y="-104">
			<name x="-104" y="-136">Initial</name>
		</location>
		<init ref="id6"/>
		<transition>
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="32" y="-87">LRI_Stop!</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="32" y="-24">VSense?</label>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-48" y="-56">VP!</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-8" y="0">LRI_Ex?</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id5"/>
			<label kind="synchronisation" x="32" y="-128">LRI_Start!</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-64" y="-128">VSense?</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id4"/>
			<label kind="synchronisation" x="120" y="-64">VRP_Ex?</label>
		</transition>
	</template>
	<template>
		<name>LRI_Timer</name>
		<parameter>urgent chan &amp;LRI_Start, broadcast chan &amp;LRI_Ex, urgent chan &amp;LRI_Stop</parameter>
		<declaration>clock x;</declaration>
		<location id="id7" x="-24" y="-16">
			<name x="-32" y="0">Timer</name>
			<label kind="invariant" x="-8" y="-24">x&lt;=TLRI</label>
		</location>
		<location id="id8" x="-24" y="-168">
			<name x="-34" y="-198">IDLE</name>
		</location>
		<init ref="id8"/>
		<transition>
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="synchronisation" x="-48" y="-96">LRI_Stop?</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id8"/>
			<label kind="guard" x="-128" y="-136">x&gt;=TLRI</label>
			<label kind="synchronisation" x="-128" y="-120">LRI_Ex!</label>
			<nail x="-72" y="-88"/>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="synchronisation" x="32" y="-120">LRI_Start?</label>
			<label kind="assignment" x="48" y="-96">x=0</label>
			<nail x="32" y="-88"/>
		</transition>
	</template>
	<template>
		<name>LRI_Monitor</name>
		<parameter>broadcast chan &amp;VSense, broadcast chan &amp;VP</parameter>
		<declaration>clock t;</declaration>
		<location id="id9" x="-16" y="-40">
			<name x="-26" y="-70">Detected</name>
			<committed/>
		</location>
		<location id="id10" x="-112" y="-40">
			<name x="-128" y="-80">Wait2</name>
		</location>
		<location id="id11" x="-208" y="-40">
			<name x="-256" y="-72">Wait1</name>
		</location>
		<init ref="id11"/>
		<transition>
			<source ref="id9"/>
			<target ref="id10"/>
			<label kind="assignment" x="-78" y="16">t=0</label>
			<nail x="-16" y="16"/>
			<nail x="-96" y="16"/>
			<nail x="-104" y="16"/>
			<nail x="-112" y="16"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-80" y="-40">VP?</label>
			<nail x="-88" y="-16"/>
			<nail x="-40" y="-16"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-184" y="-16">VP?</label>
			<label kind="assignment" x="-176" y="0">t=0</label>
			<nail x="-184" y="-16"/>
			<nail x="-136" y="-16"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id9"/>
			<label kind="synchronisation" x="-88" y="-96">VSense?</label>
			<nail x="-88" y="-72"/>
			<nail x="-40" y="-72"/>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-192" y="-104">VSense?</label>
			<label kind="assignment" x="-184" y="-88">t=0</label>
			<nail x="-184" y="-72"/>
			<nail x="-136" y="-72"/>
		</transition>
	</template>
	<template>
		<name>VRP</name>
		<parameter>broadcast chan &amp;VSense, urgent chan &amp;VRP_Start, broadcast chan &amp;VRP_Ex, broadcast chan &amp;VP</parameter>
		<location id="id12" x="-56" y="-88">
			<committed/>
		</location>
		<location id="id13" x="40" y="24">
			<name x="56" y="16">Block</name>
			<committed/>
		</location>
		<location id="id14" x="40" y="-56">
			<name x="56" y="-72">WaitVRP</name>
		</location>
		<location id="id15" x="-168" y="-56">
			<name x="-216" y="-56">IDLE</name>
		</location>
		<init ref="id15"/>
		<transition>
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-96" y="-48">VRP_Ex?</label>
			<nail x="0" y="-24"/>
			<nail x="-136" y="-24"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-128" y="-72">VP?</label>
			<nail x="-96" y="-56"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id14"/>
			<nail x="16" y="-16"/>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id13"/>
			<label kind="synchronisation" x="72" y="-24">VSense?</label>
			<nail x="64" y="-16"/>
		</transition>
		<transition>
			<source ref="id12"/>
			<target ref="id14"/>
			<label kind="synchronisation" x="-24" y="-104">VRP_Start!</label>
			<nail x="0" y="-88"/>
		</transition>
		<transition>
			<source ref="id15"/>
			<target ref="id12"/>
			<label kind="synchronisation" x="-136" y="-104">VSense?</label>
			<nail x="-136" y="-88"/>
		</transition>
	</template>
	<template>
		<name>VRP_Timer</name>
		<parameter>broadcast chan &amp;VRP_Ex, urgent chan &amp;VRP_Start</parameter>
		<declaration>clock x;</declaration>
		<location id="id16" x="-136" y="-88">
			<name x="-144" y="-72">Timer</name>
			<label kind="invariant" x="-120" y="-96">x&lt;=TVRP</label>
		</location>
		<location id="id17" x="-136" y="-192">
			<name x="-146" y="-222">IDLE</name>
		</location>
		<init ref="id17"/>
		<transition>
			<source ref="id16"/>
			<target ref="id17"/>
			<label kind="guard" x="-232" y="-152">x&gt;=TVRP</label>
			<label kind="synchronisation" x="-232" y="-136">VRP_Ex!</label>
			<nail x="-168" y="-144"/>
		</transition>
		<transition>
			<source ref="id17"/>
			<target ref="id16"/>
			<label kind="synchronisation" x="-104" y="-152">VRP_Start?</label>
			<label kind="assignment" x="-104" y="-136">x=0</label>
			<nail x="-104" y="-136"/>
		</transition>
	</template>
	<template>
		<name>VRP_Monitor</name>
		<parameter>broadcast chan &amp;VSense, broadcast chan &amp;VP, broadcast chan &amp;VRP_Ex</parameter>
		<declaration>clock t;</declaration>
		<location id="id18" x="-104" y="-144">
			<name x="-114" y="-174">Ex_Get</name>
			<committed/>
		</location>
		<location id="id19" x="-232" y="-144">
			<name x="-248" y="-176">Wait2</name>
		</location>
		<location id="id20" x="-368" y="-144">
			<name x="-392" y="-176">Wait1</name>
		</location>
		<init ref="id20"/>
		<transition>
			<source ref="id18"/>
			<target ref="id20"/>
			<label kind="assignment" x="-248" y="-96">t=0</label>
			<nail x="-104" y="-80"/>
			<nail x="-368" y="-80"/>
		</transition>
		<transition>
			<source ref="id19"/>
			<target ref="id18"/>
			<label kind="synchronisation" x="-208" y="-168">VRP_Ex?</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="-336" y="-160">VP?</label>
			<label kind="assignment" x="-296" y="-160">t=0</label>
		</transition>
		<transition>
			<source ref="id20"/>
			<target ref="id19"/>
			<label kind="synchronisation" x="-344" y="-200">VSense?</label>
			<label kind="assignment" x="-280" y="-200">t=0</label>
			<nail x="-304" y="-184"/>
		</transition>
	</template>
	<system>// Declaration goes here.
broadcast chan LRI_Start, VRP_Start, LRI_Stop;
broadcast chan VSense, VP, LRI_Ex, VRP_Ex, sync_test, DT;

// Place template instantiations here.
Random_Ventricle = RV(VSense, VP);
Con_LRI = LRI(VSense, LRI_Start, VRP_Ex, LRI_Ex, VP, LRI_Stop);
Con_VRP = VRP(VSense, VRP_Start, VRP_Ex, VP);
Timer_LRI = LRI_Timer(LRI_Start, LRI_Ex, LRI_Stop);
Timer_VRP = VRP_Timer(VRP_Ex, VRP_Start);
Monitor_LRI = LRI_Monitor(VSense, VP);
Monitor_VRP = VRP_Monitor(VSense, VP, VRP_Ex);


// List one or more processes to be composed into a system.
system Random_Ventricle, Con_LRI, Con_VRP, Timer_LRI, Timer_VRP, Monitor_LRI, Monitor_VRP;
</system>
	<queries>
		<query>
			<formula>A[] (Monitor_VRP.Ex_Get imply Monitor_VRP.t &gt;= TVRP)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>A[] (Monitor_LRI.Detected imply Monitor_LRI.t &lt;= TLRI)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>A[] not deadlock
			</formula>
			<comment>
			</comment>
		</query>
	</queries>
</nta>
